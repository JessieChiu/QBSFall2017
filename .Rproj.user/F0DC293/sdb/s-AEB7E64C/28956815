{
    "collab_server" : "",
    "contents" : "---\ntitle: \"Model Building\"\n---\n\n```{r setup, include=FALSE}\nknitr::opts_chunk$set(echo = TRUE)\n```\n\n## Load Packages\n\nLoad all required packages.\n\n```{r library}\nlibrary(readr)\nlibrary(rstan)\nlibrary(rethinking)\n```\n\n## Model 1\n\n### Building Model 1\n\n#### Import Data\n\nImport the Model 1 Dataset.\n\n```{r import.m1}\n# read files\ndata1 = read.csv(file.path(\"datasets\", \"M1.data.new.csv\"))\n```\n\n#### Preprocess Data\n\n```{r pre.m1}\nd1 = data.frame(cbind(data1$Total_cases_Number, data1$Bx1, data1$Bx2, data1$Bx3))\nnames(d1) = c(\"Total_cases_Number\",\"Bx1\",\"Bx2\",\"Bx3\") \n\nd1$crime_cases = (d1$Total_cases_Number - mean(d1$Total_cases_Number))/sd(d1$Total_cases_Number)\n```\n\n#### Build Model\n\nBuild Model 1 with map.\n\n```{r m1}\n# Method 1\nm1 <- map(\n  alist(\n    crime_cases ~ dnorm(mu, sigma),\n    mu <- a +b1*Bx1 + b2*Bx2 + b3*Bx3,\n    a ~ dnorm(0,10),\n    b1 ~ dnorm(0,10),\n    b2 ~ dnorm(0,10),\n    b3 ~ dnorm(0,10),\n    sigma ~ dunif(0,10)\n  ),\n  data <- d1,\n  start<-list(a=mean(d1$crime_cases),b1=0,b2=0,b3=0, sigma=sd(d1$crime_cases)))\n```\n\n### Examining Model 1\n\n#### Parameter Overview\n\nFrom the pairs plot below, we can see that \n\n```{r m1.pairs}\npairs(m1)\n```\n\nWe then examine the parameter estimates of Model 1.\n\n```{r m1.precis}\nprecis(m1)\n```\n\n#### Parameter Effects\n\nThe effect of movie types are shown below:\n\n1. Crime-inducing: Bx1\n\n```{r m1.bx1}\nBx1.seq <- seq(from = 0, to = 10, length.out = 100)\nmu <- link(m1, data = data.frame(Bx1 = Bx1.seq, Bx2 = mean(d1$Bx2), Bx3 = mean(d1$Bx3)))\nmu.mean <- apply(mu, 2, mean)\nmu.PI <- apply(mu, 2, PI, prob = 0.95)\n\nplot(crime_cases ~ Bx1, data = d1)\nlines(Bx1.seq, mu.mean)\n\nshade(mu.PI, Bx1.seq)\n```\n\n2. Crime-reducing: Bx2\n\n```{r m1.bx2}\nBx2.seq <- seq(from = 0, to = 111, length.out = 100)\nmu <- link(m1, data = data.frame(Bx2 = Bx2.seq, Bx1 = mean(d1$Bx1), Bx3 = mean(d1$Bx3)))\nmu.mean <- apply(mu, 2, mean)\nmu.PI <- apply(mu, 2, PI, prob = 0.95)\n\nplot(crime_cases ~ Bx2, data = d1)\nlines(Bx2.seq, mu.mean)\n\nshade(mu.PI, Bx2.seq)\n```\n\n3. Neutral: Bx3\n\n```{r m1.bx3}\nBx3.seq <- seq(from = 0, to = 11, length.out = 100)\nmu <- link(m1, data = data.frame(Bx3 = Bx3.seq, Bx1 = mean(d1$Bx1), Bx2 = mean(d1$Bx2)))\nmu.mean <- apply(mu, 2, mean)\nmu.PI <- apply(mu, 2, PI, prob = 0.95)\n\nplot(crime_cases ~ Bx3, data = d1)\nlines(Bx3.seq, mu.mean)\n\nshade(mu.PI, Bx3.seq)\n```\n\n## Model 1 With Stan\n\n### Building Model 1 With Stan\n\n#### Build Model\n\nBuild Model 1 with map2stan.\n\n```{r m1.stan}\n# Method 2\nm1.stan <- map2stan( m1, data<-d1, iter = 1e4, warmup = 1000) \n```\n\n### Examining Model 1 With Stan\n\n#### Parameter Overview\n\nFrom the pairs plot below, we can see that \n\n```{r m1.stan.pairs}\npairs(m1.stan)\n```\n\nWe then examine the parameter estimates of Model 1 with Stan.\n\n```{r m1.stan.precis}\nprecis(m1.stan)\n```\n\n#### Parameter Effects\n\nThe effect of movie types are shown below:\n\n1. Crime-inducing: Bx1\n\n```{r m1.stan.bx1}\nBx1.seq <- seq(from = 0, to = 10, length.out = 100)\nmu <- link(m1.stan, data = data.frame(Bx1 = Bx1.seq, Bx2 = mean(d1$Bx2), Bx3 = mean(d1$Bx3)))\nmu.mean <- apply(mu, 2, mean)\nmu.PI <- apply(mu, 2, PI, prob = 0.95)\n\nplot(crime_cases ~ Bx1, data = d1)\nlines(Bx1.seq, mu.mean)\n\nshade(mu.PI, Bx1.seq)\n```\n\n2. Crime-reducing: Bx2\n\n```{r m1.stan.bx2}\nBx2.seq <- seq(from = 0, to = 111, length.out = 100)\nmu <- link(m1.stan, data = data.frame(Bx2 = Bx2.seq, Bx1 = mean(d1$Bx1), Bx3 = mean(d1$Bx3)))\nmu.mean <- apply(mu, 2, mean)\nmu.PI <- apply(mu, 2, PI, prob = 0.95)\n\nplot(crime_cases ~ Bx2, data = d1)\nlines(Bx2.seq, mu.mean)\n\nshade(mu.PI, Bx2.seq)\n```\n\n3. Neutral: Bx3\n\n```{r m1.stan.bx3}\nBx3.seq <- seq(from = 0, to = 11, length.out = 100)\nmu <- link(m1.stan, data = data.frame(Bx3 = Bx3.seq, Bx1 = mean(d1$Bx1), Bx2 = mean(d1$Bx2)))\nmu.mean <- apply(mu, 2, mean)\nmu.PI <- apply(mu, 2, PI, prob = 0.95)\n\nplot(crime_cases ~ Bx3, data = d1)\nlines(Bx3.seq, mu.mean)\n\nshade(mu.PI, Bx3.seq)\n```\n\n## Model 2\n\n### Building Model 2\n\n#### Import Data\n\nImport the Model 2 Dataset.\n\n```{r import.m2}\n# read files\ndata2 = read.csv(file.path(\"datasets\", \"M2.data.new.csv\"))\n```\n\n#### Preprocess Data\n\n```{r pre.m2}\nbox_office = exp(data2$log_box_office)\nstd_b = (box_office - mean(box_office))/sd(box_office)\ndata2$std_b = std_b\n\nd2 = data.frame(cbind(data2$Total_cases_Number, data2$std_b, data2$score.s, data2$Bscore.s))\nnames(d2) = c(\"Total_cases_Number\",\"std_b\",\"score_s\",\"Bscore_s\") \n\nd2$crime_cases = (d2$Total_cases_Number - mean(d2$Total_cases_Number))/sd(d2$Total_cases_Number)\n```\n\n#### Build Model\n\nBuild Model 2 with map.\n\n```{r m2}\n# Method 1\nm2 <- map(\n  alist(\n    crime_cases ~ dnorm(mu, sigma),\n    mu <- a +c1*std_b + c2*score_s + c3*Bscore_s,\n    a ~ dnorm(0,10),\n    c1 ~ dnorm(0,10),\n    c2 ~ dnorm(0,10),\n    c3 ~ dnorm(0,10),\n    sigma ~ dunif(0,10)\n  ),\n  data <- d2,\n  start<-list(a=mean(d2$crime_cases),c1=0,c2=0,c3=0, sigma=sd(d2$crime_cases)))\n```\n\n### Examining Model 2\n\n#### Parameter Overview\n\nFrom the pairs plot below, we can see that \n\n```{r m2.pairs}\npairs(m2)\n```\n\nWe then examine the parameter estimates of Model 2.\n\n```{r m2.precis}\nprecis(m2)\n```\n\n#### Parameter Effects\n\nThe effect of box office results and movie scores are shown below:\n\n1. Box office results: std.b\n\n```{r m2.box}\nstd_b.seq <- seq(from = -3, to = 3, length.out = 100)\nmu <- link(m2, data = data.frame(std_b = std_b.seq, score_s = mean(d2$score_s), Bscore_s = mean(d2$Bscore_s)))\nmu.mean <- apply(mu, 2, mean)\nmu.PI <- apply(mu, 2, PI, prob = 0.95)\n\nplot(crime_cases ~ std_b, data = d2)\nlines(std_b.seq, mu.mean)\n\nshade(mu.PI, std_b.seq)\n```\n\n2. Movie scores: score.s\n\n```{r m2.score}\nscore_s.seq <- seq(from = -1, to = 1, length.out = 100)\nmu <- link(m2, data = data.frame(score_s = score_s.seq, std_b = mean(d2$std_b), Bscore_s = mean(d2$Bscore_s)))\nmu.mean <- apply(mu, 2, mean)\nmu.PI <- apply(mu, 2, PI, prob = 0.95)\n\nplot(crime_cases ~ score_s, data = d2)\nlines(score_s.seq, mu.mean)\n\nshade(mu.PI, score_s.seq)\n```\n\n3. Interaction between box office results and movie scores:\n\n```{r m2.boxscore}\nBscore_s.seq <- seq(from = -6, to = 9, length.out = 100)\nmu <- link(m2, data = data.frame(score_s = mean(d2$score_s), std_b = mean(d2$std_b), Bscore_s = Bscore_s.seq))\nmu.mean <- apply(mu, 2, mean)\nmu.PI <- apply(mu, 2, PI, prob = 0.95)\n\nplot(crime_cases ~ Bscore_s, data = d2)\nlines(Bscore_s.seq, mu.mean)\n\nshade(mu.PI, Bscore_s.seq)\n```\n\n## Model 2 With Stan\n\n### Building Model 2 With Stan\n\n#### Build Model\n\nBuild Model 2 with map2stan.\n\n```{r m2.stan}\n# Method 2\nm2.stan <- map2stan( m2, data<-d2, iter = 1e4, warmup = 1000) \n```\n\n### Examining Model 2 With Stan\n\n#### Parameter Overview\n\nFrom the pairs plot below, we can see that \n\n```{r m2.stan.pairs}\npairs(m2.stan)\n```\n\nWe then examine the parameter estimates of Model 2 with Stan.\n\n```{r m2.stan.precis}\nprecis(m2.stan)\n```\n\n#### Parameter Effects\n\nThe effect of box office results and movie scores are shown below:\n\n1. Box office results: std.b\n\n```{r m2.stan.box}\nstd_b.seq <- seq(from = -3, to = 3, length.out = 100)\nmu <- link(m2.stan, data = data.frame(std_b = std_b.seq, score_s = mean(d2$score_s), Bscore_s = mean(d2$Bscore_s)))\nmu.mean <- apply(mu, 2, mean)\nmu.PI <- apply(mu, 2, PI, prob = 0.95)\n\nplot(crime_cases ~ std_b, data = d2)\nlines(std_b.seq, mu.mean)\n\nshade(mu.PI, std_b.seq)\n```\n\n2. Movie scores: score.s\n\n```{r m2.stan.score}\nscore_s.seq <- seq(from = -1, to = 1, length.out = 100)\nmu <- link(m2.stan, data = data.frame(score_s = score_s.seq, std_b = mean(d2$std_b), Bscore_s = mean(d2$Bscore_s)))\nmu.mean <- apply(mu, 2, mean)\nmu.PI <- apply(mu, 2, PI, prob = 0.95)\n\nplot(crime_cases ~ score_s, data = d2)\nlines(score_s.seq, mu.mean)\n\nshade(mu.PI, score_s.seq)\n```\n\n3. Interaction between box office results and movie scores:\n\n```{r m2.stan.boxscore}\nBscore_s.seq <- seq(from = -6, to = 9, length.out = 100)\nmu <- link(m2.stan, data = data.frame(score_s = mean(d2$score_s), std_b = mean(d2$std_b), Bscore_s = Bscore_s.seq))\nmu.mean <- apply(mu, 2, mean)\nmu.PI <- apply(mu, 2, PI, prob = 0.95)\n\nplot(crime_cases ~ Bscore_s, data = d2)\nlines(Bscore_s.seq, mu.mean)\n\nshade(mu.PI, Bscore_s.seq)\n```",
    "created" : 1513065746811.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2976322734",
    "id" : "28956815",
    "lastKnownWriteTime" : 1513152135,
    "last_content_update" : 1513152135098,
    "path" : "C:/Users/jestw/Desktop/QBS/QBS Group 2_final/Website/model.Rmd",
    "project_path" : "model.Rmd",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 7,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_markdown"
}